apply plugin: 'com.android.library'

android {
    publishNonDefault true
    compileSdkVersion 25
    buildToolsVersion '25.0.3'
    defaultPublishConfig "debug"

    defaultConfig {
        minSdkVersion 16
        targetSdkVersion 25
        versionCode 1
        versionName "1.0"
        externalNativeBuild {
            cmake {
                arguments "-DANDROID_STL=c++_static"
                abiFilters 'x86', 'armeabi-v7a'// , 'arm64-v8a'
            }
        }
        ndk {
            abiFilters 'x86', 'armeabi-v7a'// , 'arm64-v8a'
        }
    }

    externalNativeBuild {
        cmake {
            path "CMakeLists.txt"
        }
    }

    // packagingOptions{
    //        doNotStrip "*/x86_64/*.so"
    // }
}

repositories {
    mavenCentral()
    jcenter()
    flatDir{
        dirs 'libs'
    }
}

dependencies {
    implementation fileTree(dir: 'libs', include: '*.jar')
    implementation 'com.squareup.okhttp3:okhttp:3.8.1'
}

task distributeDebug() {
    doLast {
        delete "dist/debug"
        copy {
            from zipTree(new File('build/outputs/aar/ejecta-v8-debug.aar'))
            into "dist/debug"
            include 'jni/**'
        }
    }
}

task distributeRelease {
    doLast {
        delete "dist/release"
        copy {
            from zipTree(new File('build/outputs/aar/ejecta-v8-release.aar'))
            into "dist/release"
            include 'jni/**'
        }
    }
}

afterEvaluate {
    bundleDebug.finalizedBy distributeDebug
    bundleRelease.finalizedBy distributeRelease
}
